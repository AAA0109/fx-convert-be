# Generated by Django 4.2.11 on 2024-05-17 17:19
import json
import logging

from django.db import migrations

logger = logging.getLogger(__name__)


def create_cache_corpay_beneficiary_task(apps, schema_editor):
    PeriodicTask = apps.get_model('django_celery_beat', 'PeriodicTask')
    IntervalSchedule = apps.get_model('django_celery_beat', 'IntervalSchedule')
    every_5_min, created = IntervalSchedule.objects.update_or_create(
        every=5,
        period='minutes'
    )
    task, created = PeriodicTask.objects.get_or_create(
        name="Cache Corpay Beneficiary",
        defaults={
            'interval': every_5_min,
            'task': 'cache_corpay_beneficiary',
            'args': json.dumps([]),
            'kwargs': json.dumps([]),
            'enabled': True
        }
    )


def remove_cache_corpay_beneficiary_task(apps, schema_editor):
    PeriodicTask = apps.get_model('django_celery_beat', 'PeriodicTask')
    try:
        task = PeriodicTask.objects.get(name="Cache Corpay Beneficiary")
        task.delete()
    except Exception as e:
        logger.error(e)


class Migration(migrations.Migration):
    dependencies = [
        ('corpay', '0060_alter_beneficiary_client_integration_id'),
    ]

    operations = [
        migrations.RunPython(create_cache_corpay_beneficiary_task, remove_cache_corpay_beneficiary_task),
    ]
